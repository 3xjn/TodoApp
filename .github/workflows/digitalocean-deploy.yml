- name: SSH into Droplet and Deploy using Docker Compose
     run: |
       ssh -o ServerAliveInterval=60 -o ServerAliveCountMax=10 -i ~/.ssh/id_rsa ${{ secrets.DROPLET_USERNAME }}@${{ secrets.DROPLET_IP }} << EOF
         set -e
         echo "Starting deployment process..."
         
         # Navigate to the app directory
         cd ~/todoapp
         
         # Stop the running services if any
         echo "Stopping existing services..."
         sudo docker-compose down || true
         
         # Load the new image if the tar file exists
         if [ -f image.tar ]; then
           echo "Loading new Docker image..."
           sudo docker load -i image.tar
           rm image.tar
         fi
         
         # Start the updated services using Docker Compose with env vars
         echo "Starting services with Docker Compose..."
         MONGO_CONNECTION_STRING="${{ secrets.MONGO_CONNECTION_STRING }}" \
         MONGO_DATABASE_NAME="${{ secrets.MONGO_DATABASE_NAME }}" \
         MONGO_COLLECTION_NAME="${{ secrets.MONGO_COLLECTION_NAME }}" \
         sudo docker-compose up -d --build
         
         echo "Deployment completed successfully!"
       EOF
